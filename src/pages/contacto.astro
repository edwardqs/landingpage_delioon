---
// src/pages/contacto.astro
import Layout from '../layouts/BaseLayout.astro';

const contactInfo = {
    address: "Calle Colombia 150, Urb. El Recreo - Trujillo, La Libertad, Perú",
    phone: "+51 913851514",
    email: "info@delionperu.com",
    linkedinUrl: "#",
    facebookUrl: "#"
};
---

<Layout title="Contacto - Delion" showFooter={false}>
  <main class="overflow-x-hidden">
    <section class="relative w-full py-20 sm:py-24 flex items-start justify-center min-h-screen" data-section-theme="light">
      <img 
        src="/images/contacto/fondocontacto.svg" 
        alt="Fondo decorativo de contacto" 
        class="absolute inset-0 w-full h-full object-cover object-center z-0 animate-slow-float"
      >

      <div class="relative z-10 w-full max-w-4xl mx-auto px-2 sm:px-3 lg:px-4">
        <div class="grid grid-cols-1 lg:grid-cols-2 shadow-xl rounded-lg overflow-hidden bg-white/10 backdrop-blur-sm animate-fade-in-up">

          <div class="bg-[#0C3C6F]/90 backdrop-blur-sm text-white p-4 sm:p-6 lg:p-8 flex flex-col order-2 lg:order-1 animate-slide-in-left">
            <h2 class="text-2xl sm:text-3xl font-bold mb-2 hover:text-blue-300 transition-colors duration-300">Ubicación</h2>
            <p class="mb-4 text-sm sm:text-base hover:text-blue-200 transition-colors duration-300">{contactInfo.address}</p>
            
            <div class="w-full aspect-video rounded-md overflow-hidden mb-6 sm:mb-8 hover:scale-105 transition-transform duration-500 shadow-2xl hover:shadow-blue-500/25">
              <iframe 
                  src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3949.627797825226!2d-79.03578762582846!3d-8.13941408169225!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x91ad3d9c31320439%3A0x1b4181987158913b!2sC.%20Colombia%20150%2C%20Trujillo%2013008!5e0!3m2!1ses-419!2spe!4v1723485412586!5m2!1ses-419!2spe" 
                  width="100%" 
                  height="100%" 
                  style="border:0;" 
                  allowfullscreen="" 
                  loading="lazy" 
                  referrerpolicy="no-referrer-when-downgrade">
              </iframe>
            </div>

            <div class="space-y-4 mb-6 sm:mb-8">
              <div class="flex items-center gap-3 hover:scale-105 transition-transform duration-300 cursor-pointer group">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="flex-shrink-0 group-hover:rotate-12 transition-transform duration-300">
                  <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                </svg>
                <a href={`tel:${contactInfo.phone}`} class="hover:underline text-sm sm:text-base break-all hover:text-blue-300 transition-colors duration-300">
                  {contactInfo.phone}
                </a>
              </div>
              <div class="flex items-center gap-3 hover:scale-105 transition-transform duration-300 cursor-pointer group">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="flex-shrink-0 group-hover:rotate-12 transition-transform duration-300">
                  <rect width="20" height="16" x="2" y="4" rx="2"/>
                  <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
                </svg>
                <a href={`mailto:${contactInfo.email}`} class="hover:underline text-sm sm:text-base break-all hover:text-blue-300 transition-colors duration-300">
                  {contactInfo.email}
                </a>
              </div>
            </div>
            
            <div class="mt-auto">
              <h3 class="text-xl sm:text-2xl font-bold mb-4 hover:text-blue-300 transition-colors duration-300">Síguenos</h3>
              <div class="flex gap-4 mb-6 sm:mb-8">
                <a href={contactInfo.linkedinUrl} target="_blank" class="hover:opacity-80 transition-all duration-300 hover:scale-110 hover:rotate-12">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/>
                    <rect width="4" height="12" x="2" y="9"/>
                    <circle cx="4" cy="4" r="2"/>
                  </svg>
                </a>
                <a href={contactInfo.facebookUrl} target="_blank" class="hover:opacity-80 transition-all duration-300 hover:scale-110 hover:rotate-12">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
                  </svg>
                </a>
              </div>
              <p class="text-xs sm:text-sm text-gray-400 hover:text-gray-300 transition-colors duration-300">© 2024 Política de Privacidad</p>
            </div>
          </div>

          <div class="bg-white/90 backdrop-blur-sm p-3 sm:p-4 lg:p-6 order-1 lg:order-2 animate-slide-in-right">
            <h2 class="text-base sm:text-lg font-bold text-gray-800 uppercase mb-3 hover:text-blue-600 transition-colors duration-300">
              Contacto
            </h2>
            
            <!-- Mensaje de estado -->
            <div id="status-message" class="hidden mb-4 p-3 rounded-md text-sm animate-fade-in"></div>
            

            
            <form id="contact-form" class="space-y-4">
              <div class="animate-fade-in-up" style="animation-delay: 0.1s;">
                <input 
                  type="text" 
                  name="nombre"
                  placeholder="Nombre" 
                  required
                  class="w-full bg-gray-100 px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-delion-blue outline-none transition-all duration-300 text-sm hover:bg-gray-50 hover:border-blue-400 focus:bg-white focus:scale-105"
                />
              </div>
              <div class="animate-fade-in-up" style="animation-delay: 0.2s;">
                <input 
                  type="email" 
                  name="email"
                  placeholder="Email" 
                  required
                  class="w-full bg-gray-100 px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-delion-blue outline-none transition-all duration-300 text-sm hover:bg-gray-50 hover:border-blue-400 focus:bg-white focus:scale-105"
                />
              </div>
              <div class="animate-fade-in-up" style="animation-delay: 0.3s;">
                <input 
                  type="text" 
                  name="empresa"
                  placeholder="Empresa" 
                  class="w-full bg-gray-100 px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-delion-blue outline-none transition-all duration-300 text-sm hover:bg-gray-50 hover:border-blue-400 focus:bg-white focus:scale-105"
                />
              </div>
              <div class="animate-fade-in-up" style="animation-delay: 0.4s;">
                <select name="categoria" required class="w-full bg-gray-100 px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-delion-blue outline-none transition-all duration-300 text-gray-500 text-sm hover:bg-gray-50 hover:border-blue-400 focus:bg-white focus:scale-105">
                  <option value="" disabled selected>Categoría</option>
                  <option value="general">General</option>
                  <option value="soporte">Soporte</option>
                  <option value="ventas">Ventas</option>
                </select>
              </div>
              <div class="animate-fade-in-up" style="animation-delay: 0.5s;">
                <select name="producto" required class="w-full bg-gray-100 px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-delion-blue outline-none transition-all duration-300 text-gray-500 text-sm hover:bg-gray-50 hover:border-blue-400 focus:bg-white focus:scale-105">
                  <option value="" disabled selected>Producto</option>
                  <option value="explorer">Explorer</option>
                  <option value="hapza">Hapza</option>
                  <option value="pulsar">Pulsar</option>
                  <option value="directhole">DirectHole</option>
                  <option value="otro">Otro</option>
                </select>
              </div>
              <div class="animate-fade-in-up" style="animation-delay: 0.6s;">
                <textarea 
                  name="mensaje"
                  placeholder="Mensaje" 
                  rows="4" 
                  required
                  class="w-full bg-gray-100 px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-delion-blue outline-none transition-all duration-300 resize-none text-sm hover:bg-gray-50 hover:border-blue-400 focus:bg-white focus:scale-105"
                ></textarea>
              </div>
              <div class="text-right pt-2 animate-fade-in-up" style="animation-delay: 0.7s;">
                <button 
                  type="submit" 
                  id="submit-btn"
                  class="bg-gradient-to-r from-[#0A192F] to-[#4d0b1a] text-white font-bold py-3 px-8 rounded-md hover:opacity-90 transition-all duration-300 w-full sm:w-auto disabled:opacity-50 hover:scale-105 hover:shadow-xl hover:shadow-red-500/25"
                >
                  <span id="btn-text">Enviar</span>
                  <span id="btn-loading" class="hidden">Enviando...</span>
                </button>
              </div>
            </form>
          </div>

        </div>
      </div>
    </section>
  </main>
</Layout>

<style>
    @keyframes slow-float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-10px) rotate(1deg); }
    }
    
    @keyframes slide-in-left {
        0% { transform: translateX(-100px); opacity: 0; }
        100% { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slide-in-right {
        0% { transform: translateX(100px); opacity: 0; }
        100% { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes fade-in-up {
        0% { transform: translateY(30px); opacity: 0; }
        100% { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes fade-in {
        0% { opacity: 0; transform: scale(0.95); }
        100% { opacity: 1; transform: scale(1); }
    }
    
    .animate-slow-float {
        animation: slow-float 8s ease-in-out infinite;
    }
    
    .animate-slide-in-left {
        animation: slide-in-left 1.2s ease-out;
    }
    
    .animate-slide-in-right {
        animation: slide-in-right 1.2s ease-out 0.3s forwards;
        opacity: 0;
    }
    
    .animate-fade-in-up {
        animation: fade-in-up 0.8s ease-out forwards;
        opacity: 0;
    }
    
    .animate-fade-in {
        animation: fade-in 0.5s ease-out;
    }
</style>

<script>
// Declarar tipo global para EmailJS
declare global {
    interface Window {
        emailjs: any;
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Configuración de EmailJS desde variables de entorno
    const EMAILJS_CONFIG = {
        serviceID: import.meta.env.EMAILJS_SERVICE_ID || 'service_nnwj86i',
        templateID: import.meta.env.EMAILJS_TEMPLATE_ID || 'template_hlj1vn5',
        publicKey: import.meta.env.EMAILJS_PUBLIC_KEY || '0dnnYljiBXHZ_hYpj'
    };

    // Log para verificar que las variables se carguen correctamente
    console.log('Variables de entorno cargadas:', {
        serviceID: import.meta.env.EMAILJS_SERVICE_ID ? '✅ Cargada' : '❌ No encontrada',
        templateID: import.meta.env.EMAILJS_TEMPLATE_ID ? '✅ Cargada' : '❌ No encontrada',
        publicKey: import.meta.env.EMAILJS_PUBLIC_KEY ? '✅ Cargada' : '❌ No encontrada'
    });

    const form = document.getElementById('contact-form') as HTMLFormElement;
    const statusMessage = document.getElementById('status-message') as HTMLElement;
    const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
    const btnText = document.getElementById('btn-text') as HTMLElement;
    const btnLoading = document.getElementById('btn-loading') as HTMLElement;


    function showStatus(message: string, isError: boolean = false) {
        
        statusMessage.textContent = message;
        
        if (isError) {
            statusMessage.className = 'mb-4 p-3 rounded-md text-sm bg-red-100 text-red-700 border border-red-300 animate-fade-in';
        } else {
            statusMessage.className = 'mb-4 p-3 rounded-md text-sm bg-green-100 text-green-700 border border-green-300 animate-fade-in';
        }
        
        statusMessage.classList.remove('hidden');
    }

    function setLoading(loading: boolean) {
        submitBtn.disabled = loading;
        if (loading) {
            btnText.classList.add('hidden');
            btnLoading.classList.remove('hidden');
        } else {
            btnText.classList.remove('hidden');
            btnLoading.classList.add('hidden');
        }
    }

    // Cargar EmailJS al inicio
    let emailjsLoaded = false;
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js';
    document.head.appendChild(script);
    
    script.onload = function() {
        try {
            window.emailjs.init(EMAILJS_CONFIG.publicKey);
            emailjsLoaded = true;
            console.log('EmailJS cargado correctamente');
        } catch (error) {
            console.error('Error al inicializar EmailJS:', error);
            emailjsLoaded = false;
        }
    };
    
    script.onerror = function() {
        console.error('Error al cargar EmailJS');
        emailjsLoaded = false;
    };

    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        setLoading(true);
        statusMessage.classList.add('hidden');

        // Verificar que EmailJS esté cargado
        if (!emailjsLoaded) {
            showStatus('EmailJS no está cargado. Por favor, recarga la página e intenta nuevamente.', true);
            setLoading(false);
            return;
        }

        try {
            // Recopilar datos del formulario
            const formData = new FormData(form);
            const templateParams = {
                desde_nombre: formData.get('nombre'),
                desde_correo_electronico: formData.get('email'),
                empresa: formData.get('empresa') || 'No especificada',
                categoria: formData.get('categoria'),
                producto: formData.get('producto'),
                mensaje: formData.get('mensaje')
            };

            console.log('Enviando email con parámetros:', templateParams);

            // Enviar email
            window.emailjs.send(
                EMAILJS_CONFIG.serviceID,
                EMAILJS_CONFIG.templateID,
                templateParams
            ).then(function(result: any) {
                console.log('Email enviado exitosamente:', result);
                showStatus('¡Mensaje enviado correctamente! Te contactaremos pronto.', false);
                form.reset();
                setLoading(false);
            }).catch(function(error: any) {
                console.error('Error detallado al enviar email:', error);
                let errorMessage = 'Error al enviar el mensaje. ';
                if (error.text) {
                    errorMessage += error.text;
                } else if (error.message) {
                    errorMessage += error.message;
                } else {
                    errorMessage += 'Por favor, intenta nuevamente.';
                }
                showStatus(errorMessage, true);
                setLoading(false);
            });

        } catch (error: any) {
            console.error('Error al procesar el formulario:', error);
            showStatus('Error al procesar el formulario. Por favor, intenta nuevamente.', true);
            setLoading(false);
        }
    });
});
</script>